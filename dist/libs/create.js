var g=this&&this.__awaiter||function(e,s,t,o){return new(t||(t=Promise))((function(p,a){function n(e){try{d(o.next(e))}catch(e){a(e)}}function r(e){try{d(o.throw(e))}catch(e){a(e)}}function d(e){var s;e.done?p(e.value):(s=e.value,s instanceof t?s:new t((function(e){e(s)}))).then(n,r)}d((o=o.apply(e,s||[])).next())}))};import{execSync as ps}from"child_process";import{exit as o}from"process";import oo from"ora";import{AppRender as is}from"../generators/index.js";import{CreateAnswer as it}from"../helpers/index.js";import{CREATE_TEXT as C}from"../langs/index.js";import{DEPENDENCE as Le,GetDepsVer as ds,ShowTitle as so}from"../utils/index.js";export default function u(e){return g(this,void 0,void 0,(function*(){so("init");const{frame:s,install:t,name:p,style:a,typescript:n}=e,r=s||t||p||a||n?{appName:""===p?"unknow":p,deps:[],devdeps:[],ext:n?"ts":"js",frame:""===s?"js":s,style:""===a?"scss":a,useInstaller:t,useTs:n}:yield it(),d=oo(C.doing1).start();if(r.deps=Le[r.frame].reduce(((e,s)=>(s.disabled&&e.push(s.value),e)),r.deps).sort(),r.useTs&&(r.devdeps=["@types/node"],"react"===r.frame&&(r.deps=r.deps.filter((e=>"prop-types"!==e)),r.devdeps=[...r.devdeps,r.deps.includes("react-dom")?"@types/react-dom":""]),"ts"===r.ext&&(r.devdeps=[...r.devdeps,"@yangzw/bruce-type"]),r.devdeps=r.devdeps.filter(Boolean).sort()),is({deps:yield ds(r.deps),devdeps:yield ds(r.devdeps),ext:r.ext,frame:r.frame,name:r.appName,style:r.style,useTs:r.useTs}),d.stop(),r.useInstaller){const e=oo(C.doing2).start();try{ps(`cd ${r.appName} && yarn`),e.stop(),console.log(C.done1(r.appName))}catch(s){try{ps(`cd ${r.appName} && npm i`),e.stop(),console.log(C.done1(r.appName))}catch(s){e.stop(),console.log(C.done2(r.appName))}}}else console.log(C.done2(r.appName));o(1)}))}