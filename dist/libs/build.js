var x=this&&this.__awaiter||function(o,e,n,s){return new(n||(n=Promise))((function(i,l){function t(o){try{d(s.next(o))}catch(o){l(o)}}function r(o){try{d(s.throw(o))}catch(o){l(o)}}function d(o){var e;o.done?i(o.value):(e=o.value,e instanceof n?e:new n((function(o){o(e)}))).then(t,r)}d((s=s.apply(o,e||[])).next())}))};import{exit as o}from"process";import{CheckPath as $t,ReadJson as a,RemoveDir as eo}from"@yangzw/bruce-us/dist/node.js";import no from"ora";import{CreateWebpack as ie,ParseConfig as V}from"../configs/index.js";import{BuildAnswer as jt}from"../helpers/index.js";import{BUILD_TEXT as oo}from"../langs/index.js";import{JudgeFile as U,ShowTitle as io}from"../utils/index.js";export default function d(e){var n;return x(this,void 0,void 0,(function*(){io("build");const s=U("","configFile"),i=U("src"),{buildError:l,buildSuccess:t,useTs:r}=yield V();s||(console.log(oo.judgeBrucerc),o(1)),$t("node_modules")||(console.log(oo.judgeModules),o(1)),$t("package.json")||(console.log(oo.judgePackage),o(1)),r&&!$t("tsconfig.json")&&(console.log(oo.judgeTsconfig),o(1)),i||(console.log(oo.judgeIndexes),o(1));const{analyze:d,compress:u,lintcss:c,lintjs:m,mode:f,named:g,polyfill:p,timed:j}=e,y=d||u||c||m||f||g||p||j?{mode:""===f?"prod":f,polyfill:""===p?"es6":p,useAnalyzer:d,useCompressor:u,useCsslint:c,useHash:g,useJslint:m,useTimer:j}:yield jt(),v=no(oo.doing).start(),{mode:h,useAnalyzer:x,useTimer:w}=y,{name:b="unknown",version:k="1.0.0"}=null!==(n=a("package.json"))&&void 0!==n?n:{};!w&&eo(`dist/${f}`),v.stop();const{dist:z,flag:T}=yield ie(y);T?(console.log(oo.done(b,k,h)),yield null==t?void 0:t({dist:z,mode:h})):(console.log(oo.undone),yield null==l?void 0:l({dist:z,mode:h})),!x&&o(1)}))}