import{existsSync as nt,readdirSync as ct,readFileSync as ut,statSync as at,writeFileSync as lt}from"fs";import{dirname as w,extname as s,join as dt}from"path";import{cwd as ht,stdout as yt}from"process";import{fileURLToPath as B}from"url";import{promisify as wt}from"util";import{AsyncTo as $t,IsFunction as ue,IsObject as jt,NodeType as o,RandomNum as bt,RemoveDir as kt,WaitFor as Yt}from"@yangzw/bruce-us/dist/node.js";import ge from"chalk";import{watch as vt}from"chokidar";import Y from"dayjs";import xt from"latest-version";import N from"webpack";import Mt from"yaml";import{ACTION_TEXT as F}from"../i18n/index.js";import{REGEXP as ze}from"./getting.js";function E(t="",o=ht()){return dt(o,t)}async function ot(t=""){(0,(await import(`../../scripts/bin/${t}.js`)).default)()}async function rt(t={}){const o=wt(N),r=await o(t),n=new Promise(((t,o)=>{yt.write(r.toString({children:!1,chunkModules:!1,chunks:!1,colors:!0,modules:!1})+"\n\n"),r.hasErrors()?o(!1):t(!0)}));return $t(n)}function it(){const t=w(B(import.meta.url)),o=E("../../processlock.txt",t),r=E("../../configs",t),n=E("../../generators",t),s=E("../../templates",t);if(tt("../../processunlock.txt",t))return!1;if(!tt("../../processlock.txt",t)){const t=[7,15,30],r=t[bt(0,t.length-1)],n=Y().add(r,"day").format("DD-mm-HH-YYYY-ss-MM");lt(o,n,"utf8")}const e=ut(o,"utf8").split("-"),i=`${e[3]}-${e[5]}-${e[0]} ${e[2]}:${e[1]}:${e[4]}`;Y().format("YYYY-MM-DD HH:mm:ss")>=i&&(kt(r),kt(n),kt(s))}async function mt(t=[]){return t.reduce((async(t,o)=>{const r=await t,n=o.includes("vue")?await xt(o,{version:"next"}):await xt(o);return r[o]=n,r}),Promise.resolve({}))}function tt(t="",o=ht()){return nt(E(t,o))}function i(t="",o="entryFile"){if(!tt(t))return"";const r=ct(E(t)).filter((r=>at(E(`${t}/${r}`)).isFile()&&ze[o].test(r)))[0]||"";return r?E(`${t}/${r}`):""}function u(t="",o=ht()){const r=E(t,o),n=s(r);if(!/^\.yml$/.test(n))return{};const e=ut(r,"utf8");return Mt.parse(e)}function et(t="green",o=""){console.log(ge[`${t}Bright`](o))}function gt(t=""){console.log(`##### ${F[t]} #####`)}async function pt({mode:t="prod",opts:o=null,path:r=""}={}){await Yt(3e3);const n=ue(o)?o(t):jt(o)?o:null;if(!n||!r)return!1;const{host:s="",password:e="",port:i=9999,privateKey:c="",remotePath:m="",username:u=""}=n,a=Object.assign({host:s,port:i,username:u},c?{privateKey:c}:{password:e});console.log("上传文件的功能正在开发中",{...a,remotePath:m})}function ft(t=null){if("windows"===o().system)return;const r=w(B(import.meta.url));vt([E("../..",r),E("brucerc.js"),E("brucerc.json"),E("brucerc.yml"),E("tsconfig.json"),E("src/global.d.ts")]).on("change",(o=>{const r=o.replace(/\\/g,"/").split("/").pop();t&&t(r)}))}export{E as AbsPath,ot as AutoBin,rt as BuildApp,it as CheckParams,mt as GetDepVers,tt as IsPath,i as JudgeFile,u as ReadYml,et as ShowMsg,gt as ShowTitle,pt as UploadFiles,ft as WatchFiles};