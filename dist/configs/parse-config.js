var x=this&&this.__awaiter||function(t,e,s,n){return new(s||(s=Promise))((function(o,r){function i(t){try{u(n.next(t))}catch(t){r(t)}}function l(t){try{u(n.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(i,l)}u((n=n.apply(t,e||[])).next())}))};import{readFileSync as tt,unlinkSync as et,writeFileSync as st}from"node:fs";import{extname as nt}from"node:path";import{pathToFileURL as ot}from"node:url";import{IsEmptyArray as rt,IsEmptyObject as E,ReadJson as n,ReadYaml as it,NodeType as lt,AbsPath as S}from"@yangzw/bruce-us/dist/node.js";import ut from"typescript";import{BROWSERS_ES6 as le,JudgeFile as L}from"../utils/index.js";const{ModuleKind:ct,ScriptTarget:ft,transpileModule:at}=ut;export default function W(){return x(this,void 0,void 0,(function*(){var t,e;const s="windows"===lt().system,o=L("","configFile"),r=s?ot(o).href:o,i=nt(r).replace(/^\./,"");let l={};const u=l;if("js"===i)l=(yield import(r)).default||{};else if("json"===i)l=null!==(t=n("brucerc.json"))&&void 0!==t?t:{};else if("ts"===i){const t=S("brucerc.ts"),e=tt(t,"utf8"),n=S("brucerc.bu.js"),o=s?ot(n).href:n,r=at(e,{compilerOptions:{module:ct.ESNext,target:ft.ESNext}}).outputText;st(n,r,"utf8"),l=(yield import(o)).default||{},et(n)}else"yaml"===i&&(l=null!==(e=it("brucerc.yaml"))&&void 0!==e?e:{});if(!E(l))for(const t in l){const e=t,s=l[e];!s||rt(s)||E(s)||(u[e]=s)}return Object.assign({alias:{},browsers:le,buildError:null,buildSuccess:null,copyFiles:[],eslintIgnores:[],eslintRules:{},frame:"js",linkAssets:[],openPages:[],proxy:{},proxyHost:"",publicPath:"",scriptAssets:[],style:"scss",stylelintIgnores:[],stylelintRules:{},transpileDeps:[],useTs:!1},u)}))}