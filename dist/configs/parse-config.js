var x=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function l(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,l)}u((r=r.apply(e,t||[])).next())}))};import{readFileSync as ue,unlinkSync as ce,writeFileSync as fe}from"node:fs";import{extname as pe}from"node:path";import{pathToFileURL as de}from"node:url";import{IsEmptyArray as me,IsEmptyObject as P,ReadJson as n,ReadYaml as ye,NodeType as be,AbsPath as S}from"@yangzw/bruce-us/dist/node.js";import he from"typescript";import{BROWSERS_ES6 as le,JudgeFile as V}from"../utils/index.js";const{ModuleKind:ve,ScriptTarget:xe,transpileModule:ge}=he;export default function W(){return x(this,void 0,void 0,(function*(){var e,t;const s="windows"===be().system,r=V("","configFile"),o=s?de(r).href:r,i=pe(o).replace(/^\./,"");let l={};if("js"===i)l=(yield import(o)).default||{};else if("json"===i)l=null!==(e=n("brucerc.json"))&&void 0!==e?e:{};else if("ts"===i){const e=S("brucerc.ts"),t=ue(e,"utf8"),r=S("brucerc.bu.js"),n=s?de(r).href:r,o=ge(t,{compilerOptions:{module:ve.ESNext,target:xe.ESNext}}).outputText;fe(r,o,"utf8"),l=(yield import(n)).default||{},ce(r)}else"yaml"===i&&(l=null!==(t=ye("brucerc.yaml"))&&void 0!==t?t:{});if(!P(l))for(const e in l){const t=e,s=l[t];(!s||me(s)||P(s))&&delete l[t]}return Object.assign({alias:{},browsers:le,buildError:null,buildSuccess:null,copyFiles:[],eslintIgnores:[],eslintRules:{},frame:"js",linkAssets:[],openPages:[],proxy:{},proxyHost:"",publicPath:"",scriptAssets:[],style:"scss",stylelintIgnores:[],stylelintRules:{},transpileDeps:[],useTs:!1},l)}))}