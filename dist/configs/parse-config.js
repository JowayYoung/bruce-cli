var g=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function o(e){try{a(r.next(e))}catch(e){n(e)}}function l(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,l)}a((r=r.apply(e,t||[])).next())}))};import{readFileSync as le,unlinkSync as ae,writeFileSync as ue}from"fs";import{extname as ce}from"path";import{pathToFileURL as pe}from"url";import{IsEmptyArray as fe,IsEmptyObject as N,ReadJson as l,ReadYaml as de,NodeType as me,AbsPath as $}from"@yangzw/bruce-us/dist/node.js";import ye from"typescript";import{BROWSERS_ES6 as re,JudgeFile as k}from"../utils/index.js";const{ModuleKind:be,ScriptTarget:he,transpileModule:xe}=ye;export default function H(){var e,t;return g(this,void 0,void 0,(function*(){const s="windows"===me().system,r=k("","configFile"),i=s?pe(r).href:r,n=ce(i).replace(/^\./,"");let o={};if("js"===n)o=(yield import(i)).default||{};else if("json"===n)o=null!==(e=l("brucerc.json"))&&void 0!==e?e:{};else if("ts"===n){const e=$("brucerc.ts"),t=le(e,"utf8"),r=$("brucerc.bu.js"),i=s?pe(r).href:r,n=xe(t,{compilerOptions:{module:be.ESNext,target:he.ESNext}}).outputText;ue(r,n,"utf8"),o=(yield import(i)).default||{},ae(r)}else"yaml"===n&&(o=null!==(t=de("brucerc.yaml"))&&void 0!==t?t:{});if(!N(o))for(const e in o){const t=e,s=o[t];(!s||fe(s)||N(s))&&delete o[t]}return Object.assign({alias:{},browsers:re,buildError:null,buildSuccess:null,copyFiles:[],eslintIgnores:[],eslintRules:{},frame:"js",linkAssets:[],openPages:[],proxy:{},proxyHost:"",publicPath:"",scriptAssets:[],style:"scss",stylelintIgnores:[],stylelintRules:{},transpileDeps:[],useTs:!1},o)}))}